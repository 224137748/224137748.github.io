(window.webpackJsonp=window.webpackJsonp||[]).push([[31],{273:function(s,e,t){"use strict";t.r(e);var o=t(0),a=Object(o.a)({},(function(){var s=this,e=s.$createElement,t=s._self._c||e;return t("ContentSlotsDistributor",{attrs:{"slot-key":s.$parent.slotKey}},[t("h1",{attrs:{id:"cookie-与-session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-与-session"}},[s._v("#")]),s._v(" cookie 与 session")]),s._v(" "),t("h2",{attrs:{id:"cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie"}},[s._v("#")]),s._v(" cookie")]),s._v(" "),t("h3",{attrs:{id:"概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#概念"}},[s._v("#")]),s._v(" 概念")]),s._v(" "),t("p",[s._v("什么是 "),t("code",[s._v("Cookies")]),s._v("（“小甜饼”）呢？简单来说，"),t("code",[s._v("Cookie")]),s._v(" 就是服务器暂时存放在你的电脑里的资料（"),t("code",[s._v(".txt")]),s._v(" 格式的文本文件），好让服务器用来辨认你的计算机。当你在浏览网站的时候，"),t("code",[s._v("Web")]),s._v(" 服务器会先送一小小资料放在你的计算机上，"),t("code",[s._v("Cookies")]),s._v(" 会把你在网站上所打的文字或是一些选择都记录下来。当下次你再访问同一个网站，"),t("code",[s._v("Web")]),s._v(" 服务器会先看看有没有它上次留下的 "),t("code",[s._v("Cookies")]),s._v(" 资料，有的话，就会依据 "),t("code",[s._v("Cookie")]),s._v(" 里的内容来判断使用者，送出特定的网页内容给你。")]),s._v(" "),t("h3",{attrs:{id:"cookie-组成"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-组成"}},[s._v("#")]),s._v(" cookie 组成")]),s._v(" "),t("p",[t("code",[s._v("Cookie")]),s._v("是一段不超过 "),t("code",[s._v("4KB")]),s._v(" 的小型文本数据，由一个名称（"),t("code",[s._v("Name")]),s._v("）、一个值（"),t("code",[s._v("Value")]),s._v("）和其它几个用于控制 "),t("code",[s._v("Cookie")]),s._v("有效期、安全性、使用范围的可选属性组成。")]),s._v(" "),t("ul",[t("li",[t("code",[s._v("Name/Value")]),s._v("：设置"),t("code",[s._v("Cookie")]),s._v("的名称及相对应的值，对于认证"),t("code",[s._v("Cookie，Value")]),s._v("值包括"),t("code",[s._v("Web")]),s._v("服务器所提供的访问令牌")]),s._v(" "),t("li",[t("code",[s._v("Expires")]),s._v("属性：设置 "),t("code",[s._v("Cookie")]),s._v(" 的生存期。(详情见"),t("router-link",{attrs:{to:"/node/node_05_cookie和session.html#cookie-的生命周期"}},[s._v("生命周期")]),s._v(")")],1),s._v(" "),t("li",[t("code",[s._v("Path")]),s._v("属性：定义了"),t("code",[s._v("Web")]),s._v("站点上可以访问该"),t("code",[s._v("Cookie")]),s._v("的目录。")]),s._v(" "),t("li",[t("code",[s._v("Domain")]),s._v("属性：指定了可以访问该 "),t("code",[s._v("Cookie")]),s._v(" 的 "),t("code",[s._v("Web")]),s._v(" 站点或域。")]),s._v(" "),t("li",[t("code",[s._v("Secure")]),s._v("属性：指定是否使用"),t("code",[s._v("HTTPS")]),s._v("安全协议发送"),t("code",[s._v("Cookie")]),s._v("。")]),s._v(" "),t("li",[t("code",[s._v("HTTPOnly")]),s._v("属性 ：用于防止客户端脚本通过"),t("code",[s._v("document.cookie")]),s._v("属性访问"),t("code",[s._v("Cookie")]),s._v("，有助于保护"),t("code",[s._v("Cookie")]),s._v("不被跨站脚本攻击窃取或篡改。"),t("strong",[s._v("但是，"),t("code",[s._v("HTTPOnly")]),s._v("的应用仍存在局限性，一些浏览器可以阻止客户端脚本对"),t("code",[s._v("Cookie")]),s._v("的读操作，但允许写操作。")])])]),s._v(" "),t("h3",{attrs:{id:"cookie-作用"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-作用"}},[s._v("#")]),s._v(" cookie 作用")]),s._v(" "),t("p",[t("code",[s._v("http")]),s._v(" 协议是基于请求响应的协议，请求 --\x3e 响应，连接断开。没有办法记录客户端的状态，也就没有办法对用户的行为进行跟踪。我们知道客户端与服务器的每次通信都会携带 "),t("code",[s._v("cookie")]),s._v("， 因此我们可以根据 "),t("code",[s._v("cookie")]),s._v(" 对用户进行状态的跟踪。")]),s._v(" "),t("p",[s._v("cookie 流程：")]),s._v(" "),t("ul",[t("li",[s._v("当第一次访问服务器，服务器可以向客户端发送 "),t("code",[s._v("cookie")]),s._v("，可以往 "),t("code",[s._v("cookie")]),s._v(" 当中存入需要的数据。")]),s._v(" "),t("li",[s._v("客户端如果接收到服务器端响应的 "),t("code",[s._v("cookie")]),s._v("，会把 "),t("code",[s._v("cookie")]),s._v(" 自动保存起来。当客户端再次请求服务器的时候，浏览器会自动把客户端 "),t("code",[s._v("cookie")]),s._v(" 的数据发送到服务器。")]),s._v(" "),t("li",[s._v("服务器收到客户端的请求，获取到 "),t("code",[s._v("cookie")]),s._v("， 通过 "),t("code",[s._v("cookie")]),s._v("信息，判断用户身份，进行对应操作")])]),s._v(" "),t("h3",{attrs:{id:"使用-cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#使用-cookie"}},[s._v("#")]),s._v(" 使用 cookie")]),s._v(" "),t("ul",[t("li",[s._v("服务端：怎么发送 "),t("code",[s._v("cookie")]),s._v(" ("),t("code",[s._v("setcookie()")]),s._v(" 函数用于设置 "),t("code",[s._v("cookie")]),s._v(" );\n以"),t("code",[s._v("node.js")]),s._v(" 原生写法为例：")])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function-variable function"}},[s._v("handleServer")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token parameter"}},[s._v("req"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" res")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=>")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("{")]),s._v("\n  res"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setHeader")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"Set-Cookie"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[s._v('"userid=1234;"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("}")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("p",[s._v("服务端向客户端设置 "),t("code",[s._v("cookie")]),s._v(" php 方法:")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setcookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Alex Porter"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("ul",[t("li",[s._v("客户端：怎么获取 "),t("code",[s._v("cookie")])])]),s._v(" "),t("div",{staticClass:"language-js extra-class"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("var")]),s._v(" cookies "),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("=")]),s._v(" document"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(".")]),s._v("cookie"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h3",{attrs:{id:"cookie-的生命周期"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-的生命周期"}},[s._v("#")]),s._v(" cookie 的生命周期")]),s._v(" "),t("h4",{attrs:{id:"_1、内存-cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_1、内存-cookie"}},[s._v("#")]),s._v(" 1、内存 cookie")]),s._v(" "),t("p",[t("code",[s._v('setcookie("user", "zhuwu");')]),s._v(" 如果不设置时间(即："),t("code",[s._v("Expires/Max-Age")]),s._v(")，默认就是内存 "),t("code",[s._v("cookie")]),s._v(" ，当浏览器关闭，客户端会把 "),t("code",[s._v("cookie")]),s._v(" 清空，整个周期在浏览器的内存当中。")]),s._v(" "),t("p",[s._v("下图为在 "),t("code",[s._v("chrome")]),s._v(" 浏览器中截取网页的 "),t("code",[s._v("cookie")]),s._v("， 每个"),t("code",[s._v("cookie")]),s._v(" 都设置有过期时间。\n"),t("img",{attrs:{src:"/imgs/node/cookie_expires.png",alt:"image"}})]),s._v(" "),t("h4",{attrs:{id:"_2、硬盘-cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_2、硬盘-cookie"}},[s._v("#")]),s._v(" 2、硬盘 cookie")]),s._v(" "),t("p",[s._v("以 "),t("code",[s._v("php")]),s._v("代码示例：")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("header")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"Content-Type:text/html;charset=utf-8"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[s._v("//设置当前cookie 的时间为一天。")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setcookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"zhuwu"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token function"}},[s._v("time")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("+")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("3600")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("*")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("24")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n"),t("span",{pre:!0,attrs:{class:"token keyword"}},[s._v("echo")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"php cookie"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h4",{attrs:{id:"_3、追杀-cookie"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#_3、追杀-cookie"}},[s._v("#")]),s._v(" 3、追杀 cookie")]),s._v(" "),t("p",[s._v("把 "),t("code",[s._v("cookie")]),s._v(" 的 "),t("code",[s._v("value")]),s._v(" 设置为空，失效时间改成 "),t("code",[s._v("-1")]),s._v(" 这样即是追杀 "),t("code",[s._v("cookie")]),s._v("，把客户端成 "),t("code",[s._v("cookie")]),s._v(" 清楚。")]),s._v(" "),t("div",{staticClass:"language-php extra-class"},[t("pre",{pre:!0,attrs:{class:"language-php"}},[t("code",[t("span",{pre:!0,attrs:{class:"token function"}},[s._v("setcookie")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v("(")]),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('"user"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),s._v(" "),t("span",{pre:!0,attrs:{class:"token double-quoted-string string"}},[s._v('""')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(",")]),t("span",{pre:!0,attrs:{class:"token operator"}},[s._v("-")]),t("span",{pre:!0,attrs:{class:"token number"}},[s._v("1")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[s._v(";")]),s._v("\n")])])]),t("h2",{attrs:{id:"session"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session"}},[s._v("#")]),s._v(" session")]),s._v(" "),t("p",[s._v("在了解"),t("code",[s._v("session")]),s._v("之前，我们先了解一下"),t("code",[s._v("cookie")]),s._v("最大的缺点。")]),s._v(" "),t("p",[s._v("众所周知 "),t("code",[s._v("cookie")]),s._v("是暴露在外的，容易被人截取，因此一些安全信息不能直接使用"),t("code",[s._v("cookie")]),s._v("。我们来试想一下解决方案：")]),s._v(" "),t("ul",[t("li",[s._v("第一步： 在服务端新建一个对象 "),t("code",[s._v("var session = {};")]),s._v("，用域存储隐私数据；")]),s._v(" "),t("li",[s._v("第二步： 在服务器生成一串“乱码”作为键名 "),t("code",[s._v("var userId= Date.now();")]),s._v("，将其设置为"),t("code",[s._v("cookie")]),s._v("用域客户端与服务器网络传输")]),s._v(" "),t("li",[s._v("第三步： 在新建的对象中，设置键名，键值,"),t("code",[s._v("session[userId] = {username: 'zhangsan', password: '123'}")]),s._v("。")])]),s._v(" "),t("p",[s._v("这样将涉及到安全信息的值存储在服务器端，能有效的保证信息的安全，这里存储信息的对象称之为"),t("code",[s._v("session")]),s._v("；")]),s._v(" "),t("h3",{attrs:{id:"session-概念"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session-概念"}},[s._v("#")]),s._v(" session 概念")]),s._v(" "),t("p",[s._v("在计算机中，尤其是在网络应用中，称为“会话控制”。"),t("code",[s._v("Session")]),s._v(" 对象存储特定用户会话所需的属性及配置信息。这样，当用户在应用程序的 "),t("code",[s._v("Web")]),s._v(" 页之间跳转时，存储在 "),t("code",[s._v("Session")]),s._v(" 对象中的变量将不会丢失，而是在整个用户会话中一直存在下去。当用户请求来自应用程序的 "),t("code",[s._v("Web")]),s._v(" 页时，如果该用户还没有会话，则 "),t("code",[s._v("Web")]),s._v(" 服务器将自动创建一个 "),t("code",[s._v("Session")]),s._v(" 对象。当会话过期或被放弃后，服务器将终止该会话。")]),s._v(" "),t("h3",{attrs:{id:"工作原理"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#工作原理"}},[s._v("#")]),s._v(" 工作原理")]),s._v(" "),t("p",[s._v("实际上跟上面说的解决方案实施起来相差不大")]),s._v(" "),t("ul",[t("li",[s._v("1、服务器收到客户端的请求后，服务端主动设置一个"),t("code",[s._v("session")]),s._v("值，同时再服务端创建一个"),t("code",[s._v("session")]),s._v("池，并在返回给客户端的相应中添加一个"),t("code",[s._v("set-cookie")]),s._v("属性。")]),s._v(" "),t("li",[s._v("2、客户端收到响应后，在本地存储一个（客户端行为）"),t("code",[s._v("sessionId")]),s._v("，在此后的每次请求中都通过"),t("code",[s._v("cookie")]),s._v("的方式将"),t("code",[s._v("sessionId")]),s._v("携带到服务端")]),s._v(" "),t("li",[s._v("3、服务端拿到"),t("code",[s._v("sessionId")]),s._v("再到服务端中的"),t("code",[s._v("session")]),s._v("池中获取"),t("code",[s._v("session")]),s._v("值；")])]),s._v(" "),t("h2",{attrs:{id:"cookie-与-session-对比"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-与-session-对比"}},[s._v("#")]),s._v(" cookie 与 session 对比")]),s._v(" "),t("h3",{attrs:{id:"cookie-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#cookie-2"}},[s._v("#")]),s._v(" cookie")]),s._v(" "),t("p",[t("code",[s._v("cookie")]),s._v(" 是存储在客户端，它是服务器想客户端保存数据。记住用户名。")]),s._v(" "),t("h3",{attrs:{id:"sessionstroage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#sessionstroage"}},[s._v("#")]),s._v(" sessionStroage")]),s._v(" "),t("p",[s._v("客户端的存储，基于 html5 ，也是本地存储。生命周期。")]),s._v(" "),t("h3",{attrs:{id:"localstorage"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#localstorage"}},[s._v("#")]),s._v(" localstorage")]),s._v(" "),t("p",[s._v("本地存储，它是实例化到本地的硬盘。")]),s._v(" "),t("h3",{attrs:{id:"session-2"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#session-2"}},[s._v("#")]),s._v(" session")]),s._v(" "),t("p",[s._v("存储在服务器的，依赖 cookie。")])])}),[],!1,null,null,null);e.default=a.exports}}]);